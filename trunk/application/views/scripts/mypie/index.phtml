<?php
$this->headScript()->appendFile('http://ui.jquery.com/ui/ui.core.js');
$this->headScript()->appendFile('http://ui.jquery.com/ui/ui.slider.js');
$this->headScript()->appendFile($this->baseUrl().'/js/charitypie.js');
?>

<?php echo $this->menu('mypie'); ?>

<div id="contents">

<?php $this->searchSidebar(); ?>

<?php if (!empty($this->messages)) { ?>
<h1><?php print_r ($this->messages) ?></h1>
<?php } ?>

<h2>My Pie</h3>
<p>You pie has <?php print $this->slices_count ?>/10 slices</p>
  <?php
  if ($this->slice_changes) {
    if ($this->user()) {
    ?><p>Your latest changes have not been saved.
      <a href="<?php print $this->url(array('action'=>'savepie','controller'=>'mypie'),'default') ?>">Save</a> or
      <a href="<?php print $this->url(array('action'=>'reloadpie','controller'=>'mypie'),'default') ?>">Disgard</a>.</p><?php
    } else {
      ?>You need to <a href="<?php print $this->url(array('controller'=>'user','action'=>'register'),'default') ?>">register</a> to save your pie<?php
    }

  }
?>

<script type="text/javascript" src="<?php print $this->baseUrl() ?>/flash/version-2/js/swfobject.js"></script>
<script type="text/javascript">
swfobject.embedSWF(
  "<?php print $this->baseUrl() ?>/flash/version-2/open-flash-chart.swf", "my_chart", "550", "200",
  "9.0.0", "expressInstall.swf",
  {"data-file":"<?php print $this->url(array('dataid'=>$this->pieId,'action'=>'load','controller'=>'pie'),'data') ?>"}
  );
</script>
<div id="my_chart"></div>

<?php
  if (empty($this->pie_slices)) {
    print "no slices";
  } else {
    ?><form action="<?php print $this->baseUrl().'/pie/'.$this->pieId.'/save'; ?>" method="POST"><?php
    foreach ($this->pie_slices as $slice) {
      ?>
      <div class="slice">
        <label><?php print $slice['recipient_name'] ?></label>
        <input type="text" value="<?php print $slice['size']; ?>" name="slice-<?php print $slice['slice_id']; ?>"/>
        <p><a href="<?php print $this->url(array('sliceid'=>$slice['slice_id']),'deleteslice',true) ?>">remove from MyPie</a>
      </div>
      <?php
    }
    ?><input type="submit" value="save changes"></form><?php
  }
  ?>
</div>

<?php if ($this->user()) { ?>
  <h3>My Causes</h3>
  <?php
  foreach ($this->causes as $cause) {
    ?><a href="<?php print $this->url(array('causeid'=>$cause['cause_id']),'viewcause',true) ?>"><?php print $cause['title'] ?></a><br/><?php
  }
  ?>
  <h3>New Cause:</h3>
  <?php
  print $this->cause_form;
}
?>

<div class="clear">&nbsp;</div>
    <br class="clear" />
</div>

